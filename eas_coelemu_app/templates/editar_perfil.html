{% extends "base.html" %}
{% load static %}
{% block titulo %}Editar mi perfil{% endblock %}

<!-- Content Header (Page header) -->
{% block content_header_title%}Editar mi perfil{% endblock %}
{% block content_header_actual%}<a href="{% url 'miPerfil' request.session.usuario.id %}">Mi Perfil</a> / Editar mi
perfil
{% endblock %}
<!-- Main content -->
{% block content_main %}
<div class="row mb-3 ml-1">

</div>
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col col-md12">
                <div class="card card-warning">
                    <div class="card-header p-2">
                        <h6>Mis Datos</h6>
                    </div><!-- /.card-header -->
                    <div class="card-body container-fluid">
                        <form class="mt-3" action="{% url 'editarPerfil' usuario.id %}" method="POST"
                            id="form_editar_usuario" enctype="multipart/form-data">
                            {% csrf_token %}
                            <input type="hidden" name="registro_rol" class="form-control" value="{{ usuario.rol }}">
                            <div class="row">
                                <div class="col-md-2 mx-auto">
                                    <!-- Imagen usuario -->
                                    <div class="form-group text-center">
                                        <img src="{% static 'img/usuario.png' %}" class="img-fluid crop" width="40%">
                                    </div>
                                </div>
                                <div class="col-md-6 mx-auto">
                                    <div class="input-group mb-3">
                                        <label for="registro_nombres" class="col-sm-3 col-form-label">Nombres</label>
                                        <input type="text" class="form-control" placeholder="Nombres"
                                            id="registro_nombres" name="registro_nombres" value="{{ usuario.nombres }}">
                                        <div class="input-group-append">
                                            <div class="input-group-text">
                                                <span class="fas fa-user"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <label for="registro_ap_paterno" class="col-sm-3 col-form-label">Apellido
                                            paterno</label>
                                        <input type="text" class="form-control" placeholder="Apellido paterno"
                                            id="registro_ap_paterno" name="registro_ap_paterno"
                                            value="{{ usuario.apellido_paterno }}">
                                        <div class="input-group-append">
                                            <div class="input-group-text">
                                                <span class="fas fa-user"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <label for="registro_ap_materno" class="col-sm-3 col-form-label">Apellido
                                            materno</label>
                                        <input type="text" class="form-control" placeholder="Apellido materno"
                                            id="registro_ap_materno" name="registro_ap_materno"
                                            value="{{ usuario.apellido_materno }}">
                                        <div class="input-group-append">
                                            <div class="input-group-text">
                                                <span class="fas fa-user"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <label for="registro_rut" class="col-sm-3 col-form-label">RUT</label>
                                        <input type="text" class="form-control" placeholder="11111111-1"
                                            id="registro_rut" name="registro_rut"
                                            value="{{ usuario.rut }}-{{ usuario.dv}}" readonly>
                                        <div class="input-group-append">
                                            <div class="input-group-text">
                                                <span class="fas fa-id-card"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <label for="registro_celular" class="col-sm-3 col-form-label">Celular</label>
                                        <input type="text" class="form-control" placeholder="Celular"
                                            id="registro_celular" name="registro_celular" value="{{ usuario.celular }}">
                                        <div class="input-group-append">
                                            <div class="input-group-text">
                                                <span class="fas fa-mobile"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <label for="registro_email" class="col-sm-3 col-form-label">Email</label>
                                        <input type="email" class="form-control" placeholder="Email" id="registro_email"
                                            name="registro_email" value="{{ usuario.email }}">
                                        <div class="input-group-append">
                                            <div class="input-group-text">
                                                <span class="fas fa-envelope"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">

                                </div>
                            </div>
                            {% if request.session.usuario.rol == 'Beneficiario' %}
                            <!--=============  Registro social de hogares ==================-->
                            <div class="row mt-4">
                                <div class="col-md-2 mx-auto">
                                    <!-- Imagen hogar -->
                                    <div class="form-group text-center">
                                        <img src="{% static 'img/hogar.png' %}" class="img-fluid crop" width="40%">
                                    </div>
                                </div>
                                <div class="col-md-6 mx-auto">
                                    <div class="input-group my-3">
                                        <h5>Registro Social de Hogares del beneficiario</h5>
                                    </div>
                                    <div class="input-group mb-3">
                                        <label for="rsh_direccion" class="col-sm-3 col-form-label">Dirección</label>
                                        <input type="text" class="form-control"
                                            placeholder="Calle / Número / Villa o Población" id="rsh_direccion"
                                            name="rsh_direccion" value="{{ grupo_familiar.direccion }}">
                                        <div class="input-group-append">
                                            <div class="input-group-text">
                                                <span class="fas fa-user"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <label for="rsh_calificacion" class="col-sm-3 col-form-label">Calificación Soc.
                                            Eco. %</label>
                                        <input type="text" class="form-control" placeholder="Entre 0 y 100"
                                            id="rsh_calificacion" name="rsh_calificacion"
                                            value="{{ grupo_familiar.calif_soc_eco }}">
                                        <div class="input-group-append">
                                            <div class="input-group-text">
                                                <span class="fas fa-user"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3" id="carga_archivo_rsh">
                                        <label for="rsh_pdf" class="col-sm-3 col-form-label">RSH (archivo pdf)</label>
                                        {% if grupo_familiar.rsh_archivo %}
                                            <a href="/media/{{ grupo_familiar.rsh_archivo }}" id="archivo_actual" target="_blank">
                                                Actual:{{grupo_familiar.rsh_archivo }}
                                            </a>
                                            <a href="#" id="cargar_archivo">
                                                <span class="ml-3 badge bg-info">Subir nuevo archivo</span> 
                                            </a>
                                        {% else %}
                                            <input type="file" class="" placeholder="" id="rsh_pdf" name="rsh_pdf" accept="application/pdf">   
                                        {%endif%}                                 
                                    </div>
                                </div>
                                <div class="col-md-4">

                                </div>
                            </div>
                            {% endif %}
                            <!--============ Botones =============-->
                            <div class="row">
                                <div class="col-md-2">
                                </div>
                                <div class="col-md-6">
                                    <div class="row mt-3 float-right">
                                        <button type="submit" id="submit_editar_perfil"
                                            class="btn btn-primary">Guardar</button>
                                        <a href="{% url 'miPerfil' request.session.usuario.id %}"
                                            id="cancelar_editar_perfil" class="btn btn-primary ml-1">
                                            Cancelar
                                        </a>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                </div>
                            </div>
                        </form>
                        <!-- /.card -->

                    </div><!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>

        </div>
        <!-- /.row -->
    </div><!-- /.container-fluid -->
</section>
{% endblock %}
{% block scripts %}
<script>
    //$(function () {bsCustomFileInput.init();});
    $("#add-photo").tooltip()//para el mesaje de subir foto

    function createPreview(file) {
        var imgCodified = URL.createObjectURL(file);
        $("#foto").attr("src", imgCodified);
        $("#foto").attr("class", "img-fluid rounded-circle");
    }

    // Abrir el inspector de archivos
    $(document).on("click", "#add-photo", function () {
        $("#editar_imagen").click();
    });

    // Cachamos el evento change
    $(document).on("change", "#editar_imagen", function () {
        console.log(this.files);
        var files = this.files;
        var element;
        var supportedImages = ["image/jpeg", "image/png", "image/gif"];
        var seEncontraronElementoNoValidos = false;

        for (var i = 0; i < files.length; i++) {
            element = files[i];
            if (supportedImages.indexOf(element.type) != -1) { createPreview(element); }
            else { seEncontraronElementoNoValidos = true; }
        }
        if (seEncontraronElementoNoValidos) { toastr.error("Archivo de imagen no valido"); }
        else { toastr.success("Archivo de imagen subido correctamente"); }
    });

    
</script>
<script>
    $(document).ready(function(){    
            $('#cargar_archivo').on('click', function (){
                $('#carga_archivo_rsh').append('<input type="file" class="" placeholder="" id="rsh_pdf" name="rsh_pdf" accept="application/pdf">');
                $('#cargar_archivo').hide();
                $('#archivo_actual').hide();
                
            })
            
    });
    </script>
{% endblock %}